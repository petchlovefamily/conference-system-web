<%- contentFor('html_attribute') %> <%- contentFor('extra_css') %> <%- contentFor('content') %>

      <!-- Event Selector -->
      <div class="row mb-3">
        <div class="col-md-4">
          <select class="form-select form-select-lg" id="eventContextSelector">
            <option value="">-- Select Event --</option>
            <option value="accp2026">ACCP Annual Conference 2026</option>
            <option value="med-summit">Medical Innovation Summit</option>
          </select>
        </div>
      </div>

      <!-- Empty State (shown when no event selected) -->
      <div id="emptyState" class="text-center py-5">
        <i class="ri-calendar-event-line fs-1 text-muted"></i>
        <h4 class="mt-3 text-muted">Please select an event to view dashboard data.</h4>
      </div>

      <!-- Main Dashboard Content (hidden until event selected) -->
      <div id="mainDashboardContent" style="display: none;">

        <!-- Key Metrics -->
        <div class="row">
          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="avatar-md bg-primary-subtle rounded">
                    <i class="ri-user-line avatar-title text-primary fs-22"></i>
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <h3 class="mb-0">1,247</h3>
                    <p class="text-muted mb-0">Registrations</p>
                  </div>
                  <div class="text-end">
                    <span class="badge bg-success-subtle text-success">
                      <i class="ri-arrow-up-line"></i> 12%
                    </span>
                  </div>
                </div>
                <div class="progress progress-sm mt-3">
                  <div class="progress-bar bg-primary" style="width: 83%"></div>
                </div>
                <small class="text-muted">1,247 / 1,500 target</small>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="avatar-md bg-success-subtle rounded">
                    <i class="ri-money-dollar-circle-line avatar-title text-success fs-22"></i>
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <h3 class="mb-0">฿5.90M</h3>
                    <p class="text-muted mb-0">Revenue</p>
                  </div>
                  <div class="text-end">
                    <span class="badge bg-success-subtle text-success">
                      <i class="ri-arrow-up-line"></i> 8%
                    </span>
                  </div>
                </div>
                <div class="progress progress-sm mt-3">
                  <div class="progress-bar bg-success" style="width: 78%"></div>
                </div>
                <small class="text-muted">฿5.9M / ฿7.5M target</small>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="avatar-md bg-info-subtle rounded">
                    <i class="ri-file-text-line avatar-title text-info fs-22"></i>
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <h3 class="mb-0">156</h3>
                    <p class="text-muted mb-0">Abstracts</p>
                  </div>
                  <div class="text-end">
                    <span class="badge bg-warning-subtle text-warning">
                      23 pending
                    </span>
                  </div>
                </div>
                <div class="mt-2">
                  <small class="text-success"><i class="ri-check-line"></i> 98 accepted</small>
                  <small class="text-muted mx-2">|</small>
                  <small class="text-danger"><i class="ri-close-line"></i> 35 rejected</small>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-md-6">
            <div class="card">
              <div class="card-body">
                <div class="d-flex align-items-center">
                  <div class="avatar-md bg-warning-subtle rounded">
                    <i class="ri-qr-scan-2-line avatar-title text-warning fs-22"></i>
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <h3 class="mb-0">892</h3>
                    <p class="text-muted mb-0">Checked In</p>
                  </div>
                  <div class="text-end">
                    <span class="badge bg-success-subtle text-success">
                      71.5%
                    </span>
                  </div>
                </div>
                <div class="progress progress-sm mt-3">
                  <div class="progress-bar bg-warning" style="width: 71.5%"></div>
                </div>
                <small class="text-muted">892 / 1,247 registered</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Row (Restored Version) -->
        <div class="row">
          <div class="col-xl-8">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center py-2">
                <h5 class="mb-0">Revenue by Category</h5>
              </div>
              <div class="card-body py-2">
                <div id="revenue-chart" data-colors="#5b69bc,#10c469,#f9c851,#35b8e0"></div>
              </div>
            </div>

            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center py-2">
                <h5 class="mb-0">Registrations by Country</h5>
              </div>
              <div class="card-body py-0">
                <div class="row align-items-center">
                  <div class="col-md-7">
                    <div id="country-chart" data-colors="#5b69bc"></div>
                  </div>
                  <div class="col-md-5">
                    <div class="py-3">
                      <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span><span class="fi fi-th me-2"></span> Thailand</span>
                        <span class="fw-semibold">685 <small class="text-muted">(55%)</small></span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span><span class="fi fi-jp me-2"></span> Japan</span>
                        <span class="fw-semibold">156 <small class="text-muted">(12.5%)</small></span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span><span class="fi fi-sg me-2"></span> Singapore</span>
                        <span class="fw-semibold">124 <small class="text-muted">(10%)</small></span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span><span class="fi fi-ph me-2"></span> Philippines</span>
                        <span class="fw-semibold">87 <small class="text-muted">(7%)</small></span>
                      </div>
                      <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                        <span><span class="fi fi-my me-2"></span> Malaysia</span>
                        <span class="fw-semibold">75 <small class="text-muted">(6%)</small></span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-4">
            <div class="card">
              <div class="card-header py-2">
                <h5 class="mb-0">Ticket Sales</h5>
              </div>
              <div class="card-body">
                <div id="ticket-chart" data-colors="#5b69bc,#10c469,#f9c851,#35b8e0"></div>
                <div class="mt-2">
                  <div class="d-flex justify-content-between py-1 border-bottom">
                    <span><i class="ri-circle-fill text-primary me-1 fs-10"></i> Professional</span>
                    <span class="fw-semibold">620 <small class="text-muted">(฿4.9M)</small></span>
                  </div>
                  <div class="d-flex justify-content-between py-1 border-bottom">
                    <span><i class="ri-circle-fill text-success me-1 fs-10"></i> Student</span>
                    <span class="fw-semibold">312 <small class="text-muted">(฿1.5M)</small></span>
                  </div>
                  <div class="d-flex justify-content-between py-1 border-bottom">
                    <span><i class="ri-circle-fill text-warning me-1 fs-10"></i> Workshop</span>
                    <span class="fw-semibold">190 <small class="text-muted">(฿399K)</small></span>
                  </div>
                  <div class="d-flex justify-content-between py-1">
                    <span><i class="ri-circle-fill text-info me-1 fs-10"></i> Gala Dinner</span>
                    <span class="fw-semibold">125 <small class="text-muted">(฿275K)</small></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Check-ins Table -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0 align-middle">
                    <thead class="table-light">
                      <tr>
                        <th>Reg Code</th>
                        <th>Attendee</th>
                        <th>Event</th>
                        <th>Ticket Type</th>
                        <th>Total</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td><span class="text-primary fw-medium">REG-P-TH-001</span></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="/images/users/avatar-1.jpg" class="avatar-sm rounded-circle me-2" alt="">
                            <div>
                              <div class="fw-medium">Dr. Somchai Jaidee</div>
                              <small class="text-muted">somchai@hospital.com</small>
                            </div>
                          </div>
                        </td>
                        <td>ACCP 2026 Bangkok</td>
                        <td><span class="badge bg-primary-subtle text-primary">Professional - Early Bird</span></td>
                        <td class="fw-medium">฿5,500</td>
                        <td><span class="badge bg-success">Checked In</span></td>
                      </tr>
                      <tr>
                        <td><span class="text-primary fw-medium">REG-P-TH-002</span></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="/images/users/avatar-2.jpg" class="avatar-sm rounded-circle me-2" alt="">
                            <div>
                              <div class="fw-medium">Nattaporn Srisuk</div>
                              <small class="text-muted">nattaporn@gmail.com</small>
                            </div>
                          </div>
                        </td>
                        <td>ACCP 2026 Bangkok</td>
                        <td><span class="badge bg-primary-subtle text-primary">Professional - Regular</span></td>
                        <td class="fw-medium">฿6,500</td>
                        <td><span class="badge bg-success">Checked In</span></td>
                      </tr>
                      <tr>
                        <td><span class="text-primary fw-medium">REG-W-TH-003</span></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="/images/users/avatar-3.jpg" class="avatar-sm rounded-circle me-2" alt="">
                            <div>
                              <div class="fw-medium">Dr. Wichai Tanaka</div>
                              <small class="text-muted">wichai.t@med.edu</small>
                            </div>
                          </div>
                        </td>
                        <td>ACCP 2026 Bangkok (Workshop)</td>
                        <td><span class="badge bg-warning-subtle text-warning">Pre-conference Workshop</span></td>
                        <td class="fw-medium">฿2,000</td>
                        <td><span class="badge bg-success">Checked In</span></td>
                      </tr>
                      <tr>
                        <td><span class="text-primary fw-medium">REG-P-INT-004</span></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="/images/users/avatar-4.jpg" class="avatar-sm rounded-circle me-2" alt="">
                            <div>
                              <div class="fw-medium">Prof. Yuki Takahashi</div>
                              <small class="text-muted">yuki.t@tokyo-u.ac.jp</small>
                            </div>
                          </div>
                        </td>
                        <td>ACCP 2026 Bangkok</td>
                        <td><span class="badge bg-info-subtle text-info">Professional - International</span></td>
                        <td class="fw-medium">$350</td>
                        <td><span class="badge bg-success">Checked In</span></td>
                      </tr>
                      <tr>
                        <td><span class="text-primary fw-medium">REG-S-INT-005</span></td>
                        <td>
                          <div class="d-flex align-items-center">
                            <img src="/images/users/avatar-5.jpg" class="avatar-sm rounded-circle me-2" alt="">
                            <div>
                              <div class="fw-medium">Maria Santos</div>
                              <small class="text-muted">maria.s@ust.edu.ph</small>
                            </div>
                          </div>
                        </td>
                        <td>ACCP 2026 Bangkok</td>
                        <td><span class="badge bg-success-subtle text-success">Student - International</span></td>
                        <td class="fw-medium">$150</td>
                        <td><span class="badge bg-success">Checked In</span></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

        </div><!-- End of mainDashboardContent -->

        <%- contentFor('body_attribute') %> <%- contentFor('extra_javascript') %>
            <script src="/vendor/apexcharts/apexcharts.min.js"></script>

            <script>
              // Event Selector Toggle Logic
              var eventSelector = document.getElementById('eventContextSelector');
              var mainContent = document.getElementById('mainDashboardContent');
              var emptyState = document.getElementById('emptyState');
              var chartsRendered = false;

              function toggleEventContent() {
                var selectedEvent = eventSelector.value;
                if (selectedEvent === 'accp2026') {
                  mainContent.style.display = 'block';
                  emptyState.style.display = 'none';
                  // Render charts if not already rendered
                  if (!chartsRendered) {
                    renderCharts();
                    chartsRendered = true;
                  }
                } else if (selectedEvent === 'med-summit') {
                  mainContent.style.display = 'none';
                  emptyState.innerHTML = '<i class="ri-building-line fs-1 text-muted"></i><h4 class="mt-3 text-muted">Medical Innovation Summit data coming soon.</h4>';
                  emptyState.style.display = 'block';
                } else {
                  mainContent.style.display = 'none';
                  emptyState.innerHTML = '<i class="ri-calendar-event-line fs-1 text-muted"></i><h4 class="mt-3 text-muted">Please select an event to view dashboard data.</h4>';
                  emptyState.style.display = 'block';
                }
              }
              eventSelector.addEventListener('change', toggleEventContent);

              function renderCharts() {
                // Mock data needed if JS file isn't updated
                var ticketChart = document.querySelector("#ticket-chart");
                if (ticketChart) {
                  var options = {
                    series: [620, 312, 190, 125],
                    chart: { type: 'donut', height: 260 },
                    labels: ['Professional', 'Student', 'Workshop', 'Gala Dinner'],
                    colors: ['#5b69bc', '#10c469', '#f9c851', '#35b8e0'],
                    legend: { show: false },
                    plotOptions: { pie: { donut: { size: '70%' } } }
                  };
                  new ApexCharts(ticketChart, options).render();
                }

                var revenueChart = document.querySelector("#revenue-chart");
                if (revenueChart) {
                  var options = {
                    series: [{ name: 'Revenue', data: [4.9, 1.5, 0.4, 0.3] }],
                    chart: { type: 'bar', height: 260 },
                    xaxis: { categories: ['Professional', 'Student', 'Workshop', 'Gala'] },
                    colors: ['#5b69bc'],
                    plotOptions: { bar: { horizontal: true } }
                  };
                  new ApexCharts(revenueChart, options).render();
                }

                var countryChart = document.querySelector("#country-chart");
                if (countryChart) {
                  var options = {
                    series: [685, 156, 124, 87, 75, 120],
                    chart: { type: 'pie', height: 250 },
                    labels: ['Thailand', 'Japan', 'Singapore', 'Philippines', 'Malaysia', 'Others'],
                    colors: ['#5b69bc', '#ff6b6b', '#10c469', '#f9c851', '#35b8e0', '#6c757d'],
                    legend: { show: false },
                    dataLabels: { enabled: false }
                  };
                  new ApexCharts(countryChart, options).render();
                }
              }
            </script>